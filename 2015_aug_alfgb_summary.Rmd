---
title: "August 2015 - Alfalfa Flooding Tolerance Project Summary"
author: "Andrew Brown"
date: "August 12, 2015"
output: pdf_document
---
```{r,message=FALSE,echo=FALSE}
#Alfalfa flooding tolerance summary plots for Helen; August 2015
#@author: andrew brown

#dependencies
library(ggplot2)
library(plyr)
library(reshape2)
#----------------------------------------------------------------------------------
# Biomass bargraphs
  #SV - 2 cuttings
 sv_bio1=read.csv("27-05-15_SV_justbio.csv", stringsAsFactors=FALSE)
 sv_bio2=read.csv("15-7-15_SV_bio_Rinput.csv",stringsAsFactors=FALSE)
# 
# #test for outliers
# grubbs.test(sv_bio1$bio)
# grubbs.test(sv_bio2$bio)
# 
# #individual barplots
# #getbarplot(sv_bio1,"treat",c("C","L","M","H"))
# a1=aov(sv_bio1$bio ~ sv_bio1$treat)
# plot(a1)
# summary(a1)
# plot(TukeyHSD(a1,conf.level=0.95)) #no means separation required
# print("Assumption checking, analysis of variance, mean")
# #getbarplot(sv_bio2,"treat",c("C","L","M","H"))
# a2=aov(sv_bio2$bio ~ sv_bio2$treat)
# plot(a2)
# summary(a2)
# plot(TukeyHSD(a2,conf.level=0.95)) # means separation: C == L > M == H

#combined first and 2nd cutting

svbio=cbind(rep(1,length(sv_bio1$bio)),sv_bio1)
names(svbio) = c("cut","treat","bio")
cut2=cbind(rep(2,length(sv_bio2$bio)),sv_bio2)
names(cut2) = c("cut","treat","bio")
svbio=rbind(svbio,cut2)
svbio$treat=factor(svbio$treat,levels=c("C","L","M","H"),labels=c("Control","Low","Medium","Continued"))
svbio$bio=svbio$bio*2 #biomass per square meter conversion

#write.csv(svbio,file='2015_sv_biomass.csv')
#getbarplot(svbio,"treat",c("C","L","M","H"))

melt1=melt(svbio, id.vars=c("cut","treat"))
means1.sem <- ddply(melt1, c("cut","treat","variable"), summarise, mean=mean(value), sem=sd(value)/sqrt(length(value)))
means1.sem <- transform(means1.sem, lower=mean-sem, upper=mean+sem)
names(means1.sem) = c("cut","treat","variable","bio","sem","lower","upper")

cbar=ggplot(means1.sem,aes(treat,bio,fill=factor(cut)))+geom_bar(stat="identity",position="dodge",width=0.5)+scale_fill_discrete(name="Cutting",breaks=c(1, 2),labels=c("1st", "2nd"))+xlab("Flooding intensity")+ylab(bquote('Mean alfalfa biomass,' ~g-m^-2~''))+geom_errorbar(aes(ymax=upper,ymin=lower),position=position_dodge(0.5),width=0.4,data=means1.sem)+theme(text = element_text(size=18))
cbar 
```
Scott Valley alfalfa biomass: first and second cutting. For the first cutting there were no differences in biomass produced across levels of flooding intensity. For the second cutting the control (C) and low  (L) treatments had the highest biomass, while the high (M) and continued (H) treatments had lower biomass. Biomass was collected from 0.5 m^2 quadrats, dried at 60 degrees C and weighed. Error bars show standard error of the mean of n=8 replicate quadrats per treatment for a total of 32 independent observations per cutting.
```{r,message=FALSE,echo=FALSE}
  #CT - 1 cutting
ct_bio=read.csv("310315_plant-counts.csv",stringsAsFactors=FALSE)
ct_bio$bio=ct_bio$bio*2 #biomass per square meter conversion
ct_bio$treat=factor(ct_bio$treat,levels=c("C","JL","JH","FL","FH","ML","MH"))
melt2=melt(ct_bio, id.vars=c("treat"))
means2.sem <- ddply(melt2, c("treat","variable"), summarise, mean=mean(value), sem=sd(value)/sqrt(length(value)))
means2.sem <- transform(means2.sem, lower=mean-sem, upper=mean+sem)
names(means1.sem) = c("treat","variable","mean","sem","lower","upper")
means22.sem=means2.sem[which(means2.sem$variable == "bio"),] 
ctbar=ggplot(means22.sem,aes(treat,mean))
ctbar=ctbar+geom_bar(stat="identity",position="dodge",fill="cyan3",width=0.5)+xlab("Flooding intensity")
ctbar=ctbar+ylab(bquote('Mean alfalfa biomass,'~g-m^-2~''))
ctbar=ctbar+geom_errorbar(aes(ymax=upper,ymin=lower),position=position_dodge(0.5),width=0.4,data=means22.sem)
ctbar=ctbar+theme(text = element_text(size=18),legend.position="none")
ctbar
```
C TRACT alfalfa biomass from plots flooded at three different time intervals (J: January; F: February; M: March) during the winter. Plots recieved a 'low' 4 ft (L) or 'high' 6 ft (H) amount of water during that interval. Control (non-flooded) plots were included. The impacts of the flooding (timing or intensity) were not discernible based on the natural variation in the old stand at the site. The yield was low for all plots overall, but this was independent of treatment effects.
```{r,message=FALSE,echo=FALSE}
  #SV - First cutting weeds
sv_weed=read.csv("27-05-15_SV_bio.csv", stringsAsFactors=FALSE)
sv_weed_spp = read.csv("27-05-15_weedsout.csv", stringsAsFactors=FALSE)
sv_weedc=cbind(sv_weed['Treat'],sv_weed['Plant.C'],sv_weed['WeedBag'],sv_weed_spp)
sv_weedc$Plant.C=sv_weedc$Plant.C*2
sv_weedc$WeedBag=sv_weedc$WeedBag*2
sv_weedc$Treat=factor(sv_weedc$Treat,levels=c("C","L","M","H"),labels=c("Control","Low","Medium","Continued"))
melt3=melt(sv_weedc,id.vars=c("Treat"))
means3.sem=ddply(melt3,c("Treat","variable"),summarise,mean=mean(value),sem=sd(value)/sqrt(length(value)))
means3.sem <- transform(means3.sem, lower=mean-sem, upper=mean+sem)
names(means3.sem) = c("Treat","variable","mean","sem","lower","upper")
means3_plantc=means3.sem[which(means3.sem$variable == "Plant.C"),] 
svpcbar=ggplot(means3_plantc,aes(Treat,mean))+geom_bar(stat="identity",position="dodge",fill="cyan3")+xlab("Flooding intensity")+ylab(bquote('Mean plant count,' ~plants-m^-2 ~''))+geom_errorbar(aes(ymax=upper,ymin=lower),position=position_dodge(0.9),data=means3_plantc)+theme(text = element_text(size=18))
svpcbar
```
Scott Valley plant (crown) count, first cutting. Plant counts were not significantly different across the different levels of flooding. Plant counts are inversely proportional to weed biomass. Increased plant count is correlated with higher biomass, but appears to plateau; presumably due to competition.
```{r,message=FALSE,echo=FALSE}
means3_weedbio=means3.sem[which(means3.sem$variable == "WeedBag"),] 
svwbbar=ggplot(means3_weedbio,aes(Treat,mean))+geom_bar(stat="identity",position="dodge",fill="cyan3",width=0.5)+xlab("Flooding intensity")+ylab(bquote('Mean weed biomass,'~g-m^-2~''))+geom_errorbar(aes(ymax=upper,ymin=lower),position=position_dodge(0.5),width=0.4,data=means3_weedbio)+theme(text = element_text(size=18))
svwbbar
```
Scott Valley weed biomass, first cutting. Weed biomass in the first cutting was appreciable so we measured it separately. There were no significant differences in the mean weed biomass due to treatment effects. However, it was shown that weed biomass was inversely proportional to alfalfa plant counts per area. Clearly, interruption of herbicide spray events prior to the first cutting will allow weeds to take hold, but in this case the amount of weed biomass produced was not different across levels of flooding intensity.
```{r,message=FALSE,echo=FALSE}
#----------------------------------------------------------------------------------

# Nitrate bargraphs
  #SV - Before, middle, after
#initial
top6=c(18.2,10.4,17.8,11.1,6.3,10.6,20.0,19.7,25.0,14.5)
bot6=c(7.7,3.7,6.9,3.3,3.0,7.1,5.7,3.9,0.5,2.2)
sepN=cbind(top6,bot6)
colnames(sepN)=c("0-15cm","15-30cm")
mean(top6)
mean(bot6)
sd(top6)
sd(top6)/sqrt(10)
sd(bot6)/sqrt(10)
shapiro.test(sepN[,1])
shapiro.test(sepN[,2])
boxplot(sepN,xlab='Sampling Depth',ylab=bquote('Initial Soil '~NO[3]~'-N concentration, '~mg-kg^-1~''),width=c(0.3,0.3))
#after
sv_no3=read.csv("2015_sv_no3_final.csv")
#sv_no3$no3=log10(sv_no3$no3)
sv_no3$treat=factor(sv_no3$treat,levels=c("C","L","M","H"),labels=c("Control","Low","Medium","Continued"))
melt4=melt(sv_no3,id.vars=c("treat","rdepth"))
means4.sem=ddply(melt4, c("treat","rdepth","variable"),summarise,mean=mean(value),sem=sd(value)/sqrt(length(value)))
means4.sem=transform(means4.sem,lower=mean-sem,upper=mean+sem)
sv_july_no3=means4.sem[which(means4.sem$variable=="no3"),]
sv_july_no3=sv_july_no3[which(sv_july_no3$rdepth!=37.5),]
svjnbar=ggplot(sv_july_no3,aes(treat,mean,fill=factor(rdepth)))+geom_bar(stat="identity",position="dodge",width=0.5)+scale_fill_discrete(name="Depth",breaks=c(7.5, 22.5,37.5),labels=c("0-15 cm", "15-30 cm","30-45cm"))+xlab("Flooding intensity")+ylab(bquote('Soil '~NO[3]~'-N concentration, '~mg-kg^-1~''))+geom_errorbar(aes(ymax=upper,ymin=lower),position=position_dodge(0.5),width=0.4,data=sv_july_no3)+theme(text = element_text(size=18))
svjnbar
```
Soil near-surface NO3-N concentrations in July after winter flooding events. NO3-N concentrations were not significantly different in the surface 15cm. However, in the 15-30cm interval, the Control had an apparently significantly higher mean concentration. The control had one observation point with 0-15, 15-30 and 30-45 cm intervals all above 20 mg/kg, which does influence the values upwards for the mean concentrations for those depth intervals. Error bars reflect the standard error of the mean of n=3 replicates.
